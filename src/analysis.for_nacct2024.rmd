---
title: "Supporting Material for NACCCT 2024 Abstract"
output : html_document
fontsize: 12pt
---

```{r setup, include=FALSE, message=FALSE}
library(tidyverse)
library(readxl)
library(janitor)
library(gt)

df  <-  read_excel("../data/snapshot.05062024.xlsx", sheet = "INTOXICATE", range = cell_cols("A:O"))

xf <-  df %>%
  mutate(`Actual Disposition`  = case_when(
    `Actual Disposition` == "ICU" ~ "ICU",
    `Actual Disposition` == "GMF" ~ "Not ICU",
    `Actual Disposition` == "Discharge" ~ "Not ICU",
    TRUE ~ "NA"
  ), 
  `Predicted Disposition`  = case_when(
    `Predicted Disposition` == "ICU" ~ "ICU",
    `Predicted Disposition` == "GMF" ~ "Not ICU",
    `Predicted Disposition` == "Discharge" ~ "Not ICU",
    TRUE ~ "NA"))

xtab  <- xf %>%
 tabyl(`Actual Disposition`,`Predicted Disposition`) %>%
    select(ICU, `Not ICU`) 
```
```{r table, echo=FALSE, fig.cap="INTOXICATE Predicted vs Actual Disposition", fig.height=4, fig.width=6}

xf %>%
  tabyl(`Actual Disposition`,`Predicted Disposition`) %>%
  adorn_totals("row") %>%
  adorn_totals("col") %>%
  gt() %>%
  cols_move("NA", after = "Not ICU") %>%
  tab_header(title = "INTOXICATE vs Clinician Judgement") %>%
  tab_spanner(label = "INTOXICATE", 
    columns=c("ICU","Not ICU","NA")) %>%
  tab_footnote(html("ICU, Intensive Care Unit; Not ICU, Discharged,<br>Transferred to Psychiatry, or Admitted to<br>a General Medical Floor")) %>%
  tab_spanner(label = "Predicted Disposition")
```
<br>

```{r combined table, echo=FALSE}

```
*Results.*  We included `r nrow(df)` patients, aged `r quantile(df$Age, c(0.50))` [`r quantile(df$Age, c(0.25))` to `r quantile(df$Age, c(0.75))`] years, `r round(100*sum(df$Gender=="M")/nrow(df))`% male, `r round(100*sum(df$Gender=="F")/nrow(df))`% female. We excluded `r sum(is.na(df$"Predicted Disposition"))` patients because the chart did not contain all information needed to predict disposition or the the patient's poisoning was not a main contributor to disposition.  Of the remaining `r nrow(drop_na(df,"INTOXICATE SCORE"))` patients, `r sum(df$"Actual Disposition"=="ICU")` were admitted to the ICU,
`r sum(df$"Actual Disposition"=="GMF")` to the floor, and `r sum(df$"Actual Disposition"=="Discharge")` discharged. INTOXICATE predicted that `r sum(df$"Predicted Disposition"=="ICU" & df$"Actual Disposition"=="GMF", na.rm=TRUE)` of `r sum(df$"Actual Disposition"=="GMF", na.rm=TRUE)` patients admitted to the floor should be admitted to the ICU. None of these were transferred from the floor to the ICU or Stepdown Unit. We did not calculate the inter-rater reliability
because we obtained too few samples to accurately estimate Cohen\'s
kappa. All records contained the fields needed to calculate the
INTOXICATE risk score and inter-rater reliability.
